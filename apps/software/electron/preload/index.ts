import { ipcRenderer, contextBridge } from 'electron'

// --------- Expose some API to the Renderer process ---------
contextBridge.exposeInMainWorld('ipcRenderer', {
  on(...args: Parameters<typeof ipcRenderer.on>) {
    const [channel, listener] = args
    return ipcRenderer.on(channel, (event, ...args) => listener(event, ...args))
  },
  off(...args: Parameters<typeof ipcRenderer.off>) {
    const [channel, ...omit] = args
    return ipcRenderer.off(channel, ...omit)
  },
  send(...args: Parameters<typeof ipcRenderer.send>) {
    const [channel, ...omit] = args
    return ipcRenderer.send(channel, ...omit)
  },
  invoke(...args: Parameters<typeof ipcRenderer.invoke>) {
    const [channel, ...omit] = args
    return ipcRenderer.invoke(channel, ...omit)
  },
})

// --------- Preload scripts loading ---------
function domReady(condition: DocumentReadyState[] = ['complete', 'interactive']) {
  return new Promise(resolve => {
    if (condition.includes(document.readyState)) {
      resolve(true)
    } else {
      document.addEventListener('readystatechange', () => {
        if (condition.includes(document.readyState)) {
          resolve(true)
        }
      })
    }
  })
}

const safeDOM = {
  append(parent: HTMLElement, child: HTMLElement) {
    if (!Array.from(parent.children).find(e => e === child)) {
      return parent.appendChild(child)
    }
  },
  remove(parent: HTMLElement, child: HTMLElement) {
    if (Array.from(parent.children).find(e => e === child)) {
      return parent.removeChild(child)
    }
  },
}

function useLoading() {
  const className = `loaders-css__square-spin`
  const styleContent = `
    @keyframes reveal {
      0% {
        width: 0%;
        left: -100%;
        height: 0%;
        top: 100%;
      }
      25% {
        width: 100%;
        height: 100%;
        top: 0%;
      }
      50% {
        width: 0%;
        height: 0%;
        left: 100%;
        top: -100%;
      }
      75% {
        width: 100%;
        height: 100%;
        top: 0%;
      }
      100% {
        width: 0%;
        left: -100%;
        height: 0%;
        top: 100%;
      }
    }
    .${className} {
      position: relative;
      overflow: hidden;
    }
    .${className} > div {
      animation: reveal 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      position: absolute;
      rotate: 45deg;
      background-color: black;
      top: 0;
    }
    .app-loading-wrap {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000000;
      z-index: 9;
    }
  `
  const oStyle = document.createElement('style')
  const oDiv = document.createElement('div')

  oStyle.id = 'app-loading-style'
  oStyle.innerHTML = styleContent
  oDiv.className = 'app-loading-wrap'
  oDiv.innerHTML = `<div class="${className}">
    <div></div>
    <svg width="252" height="105" viewBox="0 0 252 105">
      <mask id="path-1-outside-1_0_1" maskUnits="userSpaceOnUse" x="0" y="0" width="252" height="105" fill="black">
        <rect fill="white" width="252" height="105" />
        <path d="M35.8435 99.768C30.4675 99.768 25.8168 98.7013 21.8915 96.568C18.0515 94.3493 14.8515 91.3627 12.2915 87.608C9.81683 83.768 7.98216 79.4587 6.7875 74.68C5.67816 69.816 5.20883 64.7813 5.3795 59.576C5.72083 50.2747 7.4275 42.2533 10.4995 35.512C13.5715 28.7707 17.4542 23.224 22.1475 18.872C26.8408 14.52 31.8755 11.32 37.2515 9.272C42.7128 7.13866 47.9608 6.072 52.9955 6.072C57.2622 6.072 61.1022 6.79733 64.5155 8.24799C68.0142 9.61333 70.7875 11.6613 72.8355 14.392C74.8835 17.0373 75.9075 20.28 75.9075 24.12C75.9075 27.1067 75.0115 30.008 73.2195 32.824C71.5128 35.5547 68.8675 37.816 65.2835 39.608C61.7848 41.3147 57.2622 42.168 51.7155 42.168C52.6542 39.4373 53.3368 37.048 53.7635 35C54.1902 32.952 54.4035 31.2027 54.4035 29.752C54.4035 26.7653 53.7208 24.76 52.3555 23.736C50.9902 22.6267 49.2835 22.072 47.2355 22.072C44.7608 22.072 42.4142 22.968 40.1955 24.76C37.9768 26.552 35.9715 28.984 34.1795 32.056C32.4728 35.0427 31.1075 38.3707 30.0835 42.04C29.0595 45.7093 28.4622 49.4213 28.2915 53.176C27.9502 62.648 29.3155 69.816 32.3875 74.68C35.4595 79.544 39.4275 81.976 44.2915 81.976C48.0462 81.976 52.1848 80.44 56.7075 77.368C61.3155 74.296 65.8382 69.6453 70.2755 63.416L71.9395 64.184C70.8302 71.864 68.3982 78.3493 64.6435 83.64C60.8888 88.9307 56.4515 92.9413 51.3315 95.672C46.2968 98.4027 41.1342 99.768 35.8435 99.768ZM121.447 99.512C118.801 99.512 116.455 98.8293 114.407 97.464C112.444 96.0987 111.505 94.0507 111.591 91.32C111.761 86.5413 112.103 81.2507 112.615 75.448C113.212 69.6453 113.895 63.7573 114.663 57.784C115.431 51.7253 116.199 45.9227 116.967 40.376C117.82 34.8293 118.588 29.88 119.271 25.528C117.735 25.3573 116.241 25.2293 114.791 25.144C113.34 25.0587 112.017 25.016 110.823 25.016C107.239 25.016 103.996 25.3573 101.095 26.04C98.2785 26.7227 95.8892 27.9173 93.9265 29.624C93.9265 24.248 94.3532 19.896 95.2065 16.568C96.1452 13.1547 97.8092 10.68 100.199 9.144C102.673 7.608 106.257 6.84 110.951 6.84C114.364 6.84 118.161 7.13866 122.343 7.73599C126.609 8.248 130.919 8.80266 135.271 9.39999C139.623 9.99733 143.676 10.296 147.431 10.296C150.503 10.296 153.233 9.99733 155.623 9.39999C158.097 8.80266 159.975 7.736 161.255 6.2C163.132 6.79733 164.583 8.12 165.607 10.168C166.631 12.1307 167.143 14.3067 167.143 16.696C167.143 18.8293 166.673 20.92 165.735 22.968C164.796 24.9307 163.303 26.5947 161.255 27.96C159.207 29.24 156.433 29.88 152.935 29.88C151.313 29.88 149.308 29.752 146.919 29.496C144.615 29.1547 142.14 28.8133 139.495 28.472C138.556 33.592 137.575 39.736 136.551 46.904C135.612 53.9867 134.801 61.624 134.119 69.816C133.521 78.008 133.137 86.328 132.967 94.776C131.431 96.3973 129.596 97.592 127.463 98.36C125.415 99.128 123.409 99.512 121.447 99.512ZM206.444 99.768C201.068 99.768 196.417 98.7013 192.492 96.568C188.652 94.3493 185.452 91.3627 182.892 87.608C180.417 83.768 178.582 79.4587 177.388 74.68C176.278 69.816 175.809 64.7813 175.98 59.576C176.321 50.2747 178.028 42.2533 181.1 35.512C184.172 28.7707 188.054 23.224 192.748 18.872C197.441 14.52 202.476 11.32 207.852 9.272C213.313 7.13866 218.561 6.072 223.596 6.072C227.862 6.072 231.702 6.79733 235.116 8.24799C238.614 9.61333 241.388 11.6613 243.436 14.392C245.484 17.0373 246.508 20.28 246.508 24.12C246.508 27.1067 245.612 30.008 243.82 32.824C242.113 35.5547 239.468 37.816 235.884 39.608C232.385 41.3147 227.862 42.168 222.316 42.168C223.254 39.4373 223.937 37.048 224.364 35C224.79 32.952 225.004 31.2027 225.004 29.752C225.004 26.7653 224.321 24.76 222.956 23.736C221.59 22.6267 219.884 22.072 217.836 22.072C215.361 22.072 213.014 22.968 210.796 24.76C208.577 26.552 206.572 28.984 204.78 32.056C203.073 35.0427 201.708 38.3707 200.684 42.04C199.66 45.7093 199.062 49.4213 198.892 53.176C198.55 62.648 199.916 69.816 202.988 74.68C206.06 79.544 210.028 81.976 214.892 81.976C218.646 81.976 222.785 80.44 227.308 77.368C231.916 74.296 236.438 69.6453 240.876 63.416L242.54 64.184C241.43 71.864 238.998 78.3493 235.244 83.64C231.489 88.9307 227.052 92.9413 221.932 95.672C216.897 98.4027 211.734 99.768 206.444 99.768Z" />
      </mask>
      <path
        d="M21.8915 96.568L19.3901 100.897L19.4466 100.93L19.5039 100.961L21.8915 96.568ZM12.2915 87.608L8.08864 90.3165L8.1238 90.3711L8.16036 90.4247L12.2915 87.608ZM6.7875 74.68L1.91267 75.7918L1.92421 75.8424L1.93678 75.8927L6.7875 74.68ZM5.3795 59.576L0.38286 59.3926L0.382503 59.4024L0.382182 59.4121L5.3795 59.576ZM10.4995 35.512L15.0494 37.5854H15.0494L10.4995 35.512ZM22.1475 18.872L18.7478 15.2057L22.1475 18.872ZM37.2515 9.272L39.0315 13.9444L39.0511 13.9369L39.0708 13.9293L37.2515 9.272ZM64.5155 8.24799L62.5598 12.8497L62.6284 12.8788L62.6978 12.9059L64.5155 8.24799ZM72.8355 14.392L68.8355 17.392L68.8585 17.4226L68.8819 17.4529L72.8355 14.392ZM73.2195 32.824L69.0012 30.1396L68.9903 30.1568L68.9795 30.174L73.2195 32.824ZM65.2835 39.608L67.4756 44.1018L67.4976 44.0911L67.5196 44.0801L65.2835 39.608ZM51.7155 42.168L46.9871 40.5426L44.7096 47.168H51.7155V42.168ZM53.7635 35L58.6584 36.0198L53.7635 35ZM52.3555 23.736L49.2025 27.6166L49.2779 27.6778L49.3555 27.736L52.3555 23.736ZM40.1955 24.76L37.0538 20.8703L37.0538 20.8703L40.1955 24.76ZM34.1795 32.056L29.8606 29.5366L29.8494 29.5559L29.8383 29.5753L34.1795 32.056ZM30.0835 42.04L25.2675 40.696V40.696L30.0835 42.04ZM28.2915 53.176L23.2967 52.949L23.2956 52.9724L23.2947 52.9959L28.2915 53.176ZM32.3875 74.68L28.1601 77.35L32.3875 74.68ZM56.7075 77.368L53.934 73.2077L53.916 73.2197L53.8981 73.2319L56.7075 77.368ZM70.2755 63.416L72.3708 58.8762L68.6077 57.1394L66.2031 60.5151L70.2755 63.416ZM71.9395 64.184L76.8881 64.8988L77.4214 61.2072L74.0348 59.6442L71.9395 64.184ZM64.6435 83.64L68.721 86.5337V86.5337L64.6435 83.64ZM51.3315 95.672L48.9786 91.2602L48.9631 91.2685L48.9477 91.2768L51.3315 95.672ZM35.8435 94.768C31.1328 94.768 27.3364 93.8365 24.2791 92.1749L19.5039 100.961C24.2972 103.566 29.8022 104.768 35.8435 104.768V94.768ZM24.3929 92.2387C21.2191 90.405 18.5706 87.9416 16.4226 84.7913L8.16036 90.4247C11.1324 94.7837 14.8838 98.2937 19.3901 100.897L24.3929 92.2387ZM16.4944 84.8995C14.3383 81.554 12.7106 77.7568 11.6382 73.4673L1.93678 75.8927C3.25374 81.1605 5.29531 85.982 8.08864 90.3165L16.4944 84.8995ZM11.6623 73.5682C10.6525 69.1404 10.2196 64.5353 10.3768 59.7398L0.382182 59.4121C0.198078 65.0273 0.703854 70.4916 1.91267 75.7918L11.6623 73.5682ZM10.3761 59.7594C10.6994 50.9498 12.3082 43.6008 15.0494 37.5854L5.94964 33.4386C2.54684 40.9059 0.742239 49.5996 0.38286 59.3926L10.3761 59.7594ZM15.0494 37.5854C17.8898 31.3521 21.4091 26.3755 25.5472 22.5383L18.7478 15.2057C13.4993 20.0725 9.25316 26.1892 5.94964 33.4386L15.0494 37.5854ZM25.5472 22.5383C29.8231 18.5734 34.3189 15.7397 39.0315 13.9444L35.4715 4.59956C29.4321 6.90028 23.8586 10.4666 18.7478 15.2057L25.5472 22.5383ZM39.0708 13.9293C44.0462 11.9857 48.6768 11.072 52.9955 11.072V1.072C47.2449 1.072 41.3794 2.29158 35.4322 4.61471L39.0708 13.9293ZM52.9955 11.072C56.6904 11.072 59.8511 11.6984 62.5598 12.8497L66.4712 3.64634C62.3533 1.89623 57.8339 1.072 52.9955 1.072V11.072ZM62.6978 12.9059C65.4188 13.9677 67.4016 15.4801 68.8355 17.392L76.8355 11.392C74.1734 7.84259 70.6096 5.25893 66.3332 3.59011L62.6978 12.9059ZM68.8819 17.4529C70.1536 19.0955 70.9075 21.2166 70.9075 24.12H80.9075C80.9075 19.3434 79.6134 14.9792 76.7891 11.3311L68.8819 17.4529ZM70.9075 24.12C70.9075 26.0466 70.3446 28.0285 69.0012 30.1396L77.4378 35.5084C79.6784 31.9875 80.9075 28.1667 80.9075 24.12H70.9075ZM68.9795 30.174C67.8667 31.9544 66.0085 33.6553 63.0474 35.1359L67.5196 44.0801C71.7265 41.9767 75.1589 39.1549 77.4595 35.474L68.9795 30.174ZM63.0914 35.1142C60.5023 36.3771 56.8033 37.168 51.7155 37.168V47.168C57.721 47.168 63.0674 46.2522 67.4756 44.1018L63.0914 35.1142ZM56.4439 43.7934C57.4272 40.9331 58.1764 38.3334 58.6584 36.0198L48.8686 33.9802C48.4973 35.7626 47.8812 37.9415 46.9871 40.5426L56.4439 43.7934ZM58.6584 36.0198C59.1271 33.7698 59.4035 31.659 59.4035 29.752H49.4035C49.4035 30.7463 49.2532 32.1342 48.8686 33.9802L58.6584 36.0198ZM59.4035 29.752C59.4035 26.3353 58.6762 22.2265 55.3555 19.736L49.3555 27.736C49.0577 27.5127 49.0624 27.3379 49.1582 27.6193C49.2669 27.9384 49.4035 28.6004 49.4035 29.752H59.4035ZM55.5085 19.8554C53.1097 17.9064 50.2342 17.072 47.2355 17.072V27.072C48.3328 27.072 48.8707 27.3469 49.2025 27.6166L55.5085 19.8554ZM47.2355 17.072C43.4468 17.072 40.0194 18.475 37.0538 20.8703L43.3372 28.6497C44.8089 27.461 46.0749 27.072 47.2355 27.072V17.072ZM37.0538 20.8703C34.2622 23.1251 31.8858 26.0649 29.8606 29.5366L38.4984 34.5754C40.0572 31.9031 41.6915 29.9789 43.3372 28.6497L37.0538 20.8703ZM29.8383 29.5753C27.9066 32.9558 26.3906 36.6716 25.2675 40.696L34.8995 43.384C35.8244 40.0697 37.0391 37.1295 38.5207 34.5367L29.8383 29.5753ZM25.2675 40.696C24.1432 44.7247 23.4847 48.8113 23.2967 52.949L33.2863 53.403C33.4396 50.0314 33.9758 46.6939 34.8995 43.384L25.2675 40.696ZM23.2947 52.9959C22.9384 62.8841 24.3041 71.2448 28.1601 77.35L36.6149 72.01C34.3269 68.3872 32.9619 62.4119 33.2883 53.3561L23.2947 52.9959ZM28.1601 77.35C31.9529 83.3554 37.3757 86.976 44.2915 86.976V76.976C41.4793 76.976 38.9661 75.7326 36.6149 72.01L28.1601 77.35ZM44.2915 86.976C49.4088 86.976 54.525 84.8948 59.5169 81.5041L53.8981 73.2319C49.8447 75.9852 46.6835 76.976 44.2915 76.976V86.976ZM59.481 81.5283C64.7476 78.0172 69.6828 72.8661 74.3479 66.3169L66.2031 60.5151C61.9936 66.4246 57.8834 70.5748 53.934 73.2077L59.481 81.5283ZM68.1802 67.9558L69.8442 68.7238L74.0348 59.6442L72.3708 58.8762L68.1802 67.9558ZM66.9909 63.4692C65.9729 70.5169 63.7798 76.2177 60.566 80.7463L68.721 86.5337C73.0165 80.481 75.6875 73.2111 76.8881 64.8988L66.9909 63.4692ZM60.566 80.7463C57.2069 85.4794 53.3364 88.9361 48.9786 91.2602L53.6844 100.084C59.5666 96.9466 64.5707 92.3819 68.721 86.5337L60.566 80.7463ZM48.9477 91.2768C44.5829 93.6442 40.2338 94.768 35.8435 94.768V104.768C42.0345 104.768 48.0108 103.161 53.7153 100.067L48.9477 91.2768ZM114.406 97.464L111.551 101.569L111.592 101.597L111.633 101.624L114.406 97.464ZM111.59 91.32L106.594 91.1415L106.593 91.1527L106.593 91.1638L111.59 91.32ZM112.615 75.448L107.641 74.936L107.637 74.9722L107.634 75.0085L112.615 75.448ZM114.663 57.784L119.622 58.4216L119.623 58.4128L114.663 57.784ZM116.967 40.376L112.025 39.6157L112.019 39.6529L112.014 39.6902L116.967 40.376ZM119.271 25.528L124.21 26.3028L125.021 21.1361L119.823 20.5586L119.271 25.528ZM114.79 25.144L114.497 30.1354L114.79 25.144ZM101.094 26.04L99.9493 21.1729L99.9329 21.1768L99.9165 21.1807L101.094 26.04ZM93.9265 29.624H88.9265V40.5978L97.2074 33.397L93.9265 29.624ZM95.2065 16.568L90.3855 15.2422L90.374 15.2841L90.3632 15.3261L95.2065 16.568ZM100.199 9.144L97.5617 4.8958L97.528 4.91669L97.4947 4.93811L100.199 9.144ZM122.342 7.73599L121.635 12.6857L121.691 12.6937L121.747 12.7004L122.342 7.73599ZM135.271 9.39999L135.95 4.44644L135.95 4.44643L135.271 9.39999ZM155.622 9.39999L154.449 4.53958L154.43 4.54435L154.41 4.54928L155.622 9.39999ZM161.255 6.2L162.771 1.43537L159.566 0.415794L157.413 2.99908L161.255 6.2ZM165.607 10.168L161.134 12.4041L161.154 12.4426L161.174 12.4808L165.607 10.168ZM165.734 22.968L170.245 25.1253L170.263 25.0884L170.28 25.0513L165.734 22.968ZM161.255 27.96L163.904 32.2L163.967 32.161L164.028 32.1202L161.255 27.96ZM146.919 29.496L146.186 34.442L146.286 34.4568L146.386 34.4675L146.919 29.496ZM139.495 28.472L140.134 23.5131L135.432 22.9063L134.576 27.5704L139.495 28.472ZM136.551 46.904L131.601 46.1969L131.597 46.222L131.594 46.2471L136.551 46.904ZM134.118 69.816L129.136 69.4008L129.134 69.4266L129.132 69.4524L134.118 69.816ZM132.967 94.776L136.596 98.2147L137.926 96.8107L137.965 94.877L132.967 94.776ZM127.462 98.36L125.769 93.6556L125.738 93.6668L125.707 93.6784L127.462 98.36ZM121.447 94.512C119.711 94.512 118.345 94.0801 117.18 93.3037L111.633 101.624C114.564 103.579 117.891 104.512 121.447 104.512V94.512ZM117.262 93.3595C116.906 93.1116 116.547 92.7985 116.588 91.4762L106.593 91.1638C106.464 95.3029 107.982 99.0857 111.551 101.569L117.262 93.3595ZM116.587 91.4985C116.754 86.8232 117.089 81.6212 117.595 75.8875L107.634 75.0085C107.116 80.8801 106.768 86.2594 106.594 91.1415L116.587 91.4985ZM117.588 75.96C118.181 70.2006 118.859 64.3545 119.622 58.4216L109.703 57.1464C108.93 63.1602 108.243 69.0901 107.641 74.936L117.588 75.96ZM119.623 58.4128C120.389 52.3714 121.154 46.5878 121.919 41.0618L112.014 39.6902C111.243 45.2575 110.472 51.0792 109.702 57.1552L119.623 58.4128ZM121.908 41.1363C122.761 35.5932 123.528 30.6489 124.21 26.3028L114.331 24.7532C113.647 29.1111 112.879 34.0654 112.025 39.6157L121.908 41.1363ZM119.823 20.5586C118.206 20.379 116.626 20.2433 115.084 20.1526L114.497 30.1354C115.856 30.2153 117.263 30.3357 118.718 30.4974L119.823 20.5586ZM115.084 20.1526C113.556 20.0627 112.133 20.016 110.823 20.016V30.016C111.901 30.016 113.124 30.0546 114.497 30.1354L115.084 20.1526ZM110.823 20.016C106.928 20.016 103.292 20.3863 99.9493 21.1729L102.24 30.9071C104.699 30.3284 107.549 30.016 110.823 30.016V20.016ZM99.9165 21.1807C96.4127 22.0302 93.2784 23.5616 90.6456 25.851L97.2074 33.397C98.4999 32.2731 100.144 31.4152 102.273 30.8992L99.9165 21.1807ZM98.9265 29.624C98.9265 24.4597 99.3418 20.5713 100.05 17.8099L90.3632 15.3261C89.3646 19.2207 88.9265 24.0363 88.9265 29.624H98.9265ZM100.028 17.8938C100.723 15.3642 101.787 14.0666 102.902 13.3499L97.4947 4.93811C93.8309 7.29343 91.5672 10.9452 90.3855 15.2422L100.028 17.8938ZM102.835 13.3922C104.172 12.5626 106.673 11.84 110.951 11.84V1.84C105.841 1.84 101.174 2.65337 97.5617 4.8958L102.835 13.3922ZM110.951 11.84C114.08 11.84 117.636 12.1144 121.635 12.6857L123.05 2.78624C118.687 2.16296 114.648 1.84 110.951 1.84V11.84ZM121.747 12.7004C125.985 13.2089 130.266 13.76 134.591 14.3536L135.95 4.44643C131.571 3.84534 127.234 3.28706 122.938 2.77161L121.747 12.7004ZM134.591 14.3535C139.131 14.9768 143.414 15.296 147.431 15.296V5.296C143.938 5.296 140.114 5.0179 135.95 4.44644L134.591 14.3535ZM147.431 15.296C150.815 15.296 153.966 14.968 156.835 14.2507L154.41 4.54928C152.501 5.02661 150.19 5.296 147.431 5.296V15.296ZM156.796 14.2604C160.027 13.4804 162.96 11.9639 165.096 9.40092L157.413 2.99908C156.989 3.50807 156.167 4.12495 154.449 4.53958L156.796 14.2604ZM159.738 10.9646C160.119 11.0858 160.608 11.3507 161.134 12.4041L170.079 7.93193C168.557 4.88929 166.144 2.50885 162.771 1.43537L159.738 10.9646ZM161.174 12.4808C161.796 13.6736 162.143 15.0466 162.143 16.696H172.143C172.143 13.5667 171.465 10.5877 170.039 7.85518L161.174 12.4808ZM162.143 16.696C162.143 18.0703 161.845 19.453 161.189 20.8847L170.28 25.0513C171.501 22.387 172.143 19.5884 172.143 16.696H162.143ZM161.224 20.8107C160.722 21.8591 159.881 22.8666 158.481 23.7998L164.028 32.1202C166.724 30.3227 168.869 28.0022 170.245 25.1253L161.224 20.8107ZM158.605 23.72C157.632 24.3281 155.893 24.88 152.935 24.88V34.88C156.973 34.88 160.781 34.1519 163.904 32.2L158.605 23.72ZM152.935 24.88C151.554 24.88 149.739 24.7696 147.451 24.5244L146.386 34.4675C148.877 34.7344 151.073 34.88 152.935 34.88V24.88ZM147.651 24.55C145.312 24.2035 142.806 23.8579 140.134 23.5131L138.855 33.4309C141.473 33.7688 143.917 34.1059 146.186 34.442L147.651 24.55ZM134.576 27.5704C133.622 32.7744 132.631 38.9869 131.601 46.1969L141.5 47.6111C142.518 40.4851 143.489 34.4096 144.413 29.3736L134.576 27.5704ZM131.594 46.2471C130.643 53.421 129.824 61.1397 129.136 69.4008L139.101 70.2312C139.778 62.1083 140.581 54.5524 141.507 47.5609L131.594 46.2471ZM129.132 69.4524C128.528 77.7343 128.14 86.1419 127.968 94.675L137.965 94.877C138.134 86.5141 138.514 78.2817 139.105 70.1796L129.132 69.4524ZM129.337 91.3373C128.347 92.3823 127.178 93.1481 125.769 93.6556L129.156 103.064C132.013 102.036 134.514 100.412 136.596 98.2147L129.337 91.3373ZM125.707 93.6784C124.156 94.2598 122.745 94.512 121.447 94.512V104.512C124.073 104.512 126.673 103.996 129.218 103.042L125.707 93.6784ZM192.492 96.568L189.99 100.897L190.047 100.93L190.104 100.961L192.492 96.568ZM182.892 87.608L178.689 90.3165L178.724 90.3711L178.76 90.4247L182.892 87.608ZM177.387 74.68L172.513 75.7918L172.524 75.8424L172.537 75.8927L177.387 74.68ZM175.98 59.576L170.983 59.3926L170.983 59.4024L170.982 59.4121L175.98 59.576ZM181.1 35.512L185.649 37.5854L181.1 35.512ZM192.747 18.872L189.348 15.2057L192.747 18.872ZM207.852 9.272L209.631 13.9444L209.651 13.9369L209.671 13.9293L207.852 9.272ZM235.116 8.24799L233.16 12.8497L233.228 12.8788L233.298 12.9059L235.116 8.24799ZM243.436 14.392L239.436 17.392L239.458 17.4226L239.482 17.4529L243.436 14.392ZM243.82 32.824L239.601 30.1396L239.59 30.1568L239.58 30.174L243.82 32.824ZM235.884 39.608L238.076 44.1018L238.098 44.0911L238.12 44.0801L235.884 39.608ZM222.316 42.168L217.587 40.5426L215.31 47.168H222.316V42.168ZM224.364 35L229.258 36.0198L224.364 35ZM222.956 23.736L219.803 27.6166L219.878 27.6778L219.956 27.736L222.956 23.736ZM210.796 24.76L207.654 20.8703V20.8703L210.796 24.76ZM204.78 32.056L200.461 29.5366L200.449 29.5559L200.438 29.5753L204.78 32.056ZM200.684 42.04L195.868 40.696V40.696L200.684 42.04ZM198.892 53.176L193.897 52.949L193.896 52.9724L193.895 52.9959L198.892 53.176ZM202.988 74.68L198.76 77.35L202.988 74.68ZM227.308 77.368L224.534 73.2077L224.516 73.2197L224.498 73.2319L227.308 77.368ZM240.876 63.416L242.971 58.8762L239.208 57.1394L236.803 60.5151L240.876 63.416ZM242.539 64.184L247.488 64.8988L248.021 61.2072L244.635 59.6442L242.539 64.184ZM235.243 83.64L239.321 86.5337V86.5337L235.243 83.64ZM221.932 95.672L219.579 91.2602L219.563 91.2685L219.548 91.2768L221.932 95.672ZM206.444 94.768C201.733 94.768 197.936 93.8365 194.879 92.1749L190.104 100.961C194.897 103.566 200.402 104.768 206.444 104.768V94.768ZM194.993 92.2387C191.819 90.405 189.171 87.9416 187.023 84.7913L178.76 90.4247C181.732 94.7837 185.484 98.2937 189.99 100.897L194.993 92.2387ZM187.094 84.8995C184.938 81.554 183.311 77.7568 182.238 73.4673L172.537 75.8927C173.854 81.1605 175.895 85.982 178.689 90.3165L187.094 84.8995ZM182.262 73.5682C181.252 69.1404 180.82 64.5353 180.977 59.7398L170.982 59.4121C170.798 65.0273 171.304 70.4916 172.513 75.7918L182.262 73.5682ZM180.976 59.7594C181.299 50.9498 182.908 43.6008 185.649 37.5854L176.55 33.4386C173.147 40.9059 171.342 49.5996 170.983 59.3926L180.976 59.7594ZM185.649 37.5854C188.49 31.3521 192.009 26.3755 196.147 22.5383L189.348 15.2057C184.099 20.0725 179.853 26.1892 176.55 33.4386L185.649 37.5854ZM196.147 22.5383C200.423 18.5734 204.919 15.7397 209.631 13.9444L206.072 4.59956C200.032 6.90028 194.459 10.4666 189.348 15.2057L196.147 22.5383ZM209.671 13.9293C214.646 11.9857 219.277 11.072 223.596 11.072V1.072C217.845 1.072 211.979 2.29158 206.032 4.61471L209.671 13.9293ZM223.596 11.072C227.29 11.072 230.451 11.6984 233.16 12.8497L237.071 3.64634C232.953 1.89623 228.434 1.072 223.596 1.072V11.072ZM233.298 12.9059C236.019 13.9677 238.002 15.4801 239.436 17.392L247.436 11.392C244.773 7.84259 241.21 5.25893 236.933 3.59011L233.298 12.9059ZM239.482 17.4529C240.754 19.0955 241.508 21.2166 241.508 24.12H251.508C251.508 19.3434 250.213 14.9792 247.389 11.3311L239.482 17.4529ZM241.508 24.12C241.508 26.0466 240.945 28.0285 239.601 30.1396L248.038 35.5084C250.278 31.9875 251.508 28.1667 251.508 24.12H241.508ZM239.58 30.174C238.467 31.9544 236.609 33.6553 233.647 35.1359L238.12 44.0801C242.326 41.9767 245.759 39.1549 248.06 35.474L239.58 30.174ZM233.691 35.1142C231.102 36.3771 227.403 37.168 222.316 37.168V47.168C228.321 47.168 233.667 46.2522 238.076 44.1018L233.691 35.1142ZM227.044 43.7934C228.027 40.9331 228.776 38.3334 229.258 36.0198L219.469 33.9802C219.097 35.7626 218.481 37.9415 217.587 40.5426L227.044 43.7934ZM229.258 36.0198C229.727 33.7698 230.004 31.659 230.004 29.752H220.004C220.004 30.7463 219.853 32.1342 219.469 33.9802L229.258 36.0198ZM230.004 29.752C230.004 26.3353 229.276 22.2265 225.956 19.736L219.956 27.736C219.658 27.5127 219.662 27.3379 219.758 27.6193C219.867 27.9384 220.004 28.6004 220.004 29.752H230.004ZM226.108 19.8554C223.71 17.9064 220.834 17.072 217.836 17.072V27.072C218.933 27.072 219.471 27.3469 219.803 27.6166L226.108 19.8554ZM217.836 17.072C214.047 17.072 210.619 18.475 207.654 20.8703L213.937 28.6497C215.409 27.461 216.675 27.072 217.836 27.072V17.072ZM207.654 20.8703C204.862 23.1251 202.486 26.0649 200.461 29.5366L209.098 34.5754C210.657 31.9031 212.291 29.9789 213.937 28.6497L207.654 20.8703ZM200.438 29.5753C198.507 32.9558 196.991 36.6716 195.868 40.696L205.499 43.384C206.424 40.0697 207.639 37.1295 209.121 34.5367L200.438 29.5753ZM195.868 40.696C194.743 44.7247 194.085 48.8113 193.897 52.949L203.886 53.403C204.04 50.0314 204.576 46.6939 205.499 43.384L195.868 40.696ZM193.895 52.9959C193.538 62.8841 194.904 71.2448 198.76 77.35L207.215 72.01C204.927 68.3872 203.562 62.4119 203.888 53.3561L193.895 52.9959ZM198.76 77.35C202.553 83.3554 207.976 86.976 214.892 86.976V76.976C212.079 76.976 209.566 75.7326 207.215 72.01L198.76 77.35ZM214.892 86.976C220.009 86.976 225.125 84.8948 230.117 81.5041L224.498 73.2319C220.445 75.9852 217.284 76.976 214.892 76.976V86.976ZM230.081 81.5283C235.348 78.0172 240.283 72.8661 244.948 66.3169L236.803 60.5151C232.594 66.4246 228.483 70.5748 224.534 73.2077L230.081 81.5283ZM238.78 67.9558L240.444 68.7238L244.635 59.6442L242.971 58.8762L238.78 67.9558ZM237.591 63.4692C236.573 70.5169 234.38 76.2177 231.166 80.7463L239.321 86.5337C243.617 80.481 246.287 73.2111 247.488 64.8988L237.591 63.4692ZM231.166 80.7463C227.807 85.4794 223.936 88.9361 219.579 91.2602L224.284 100.084C230.167 96.9466 235.171 92.3819 239.321 86.5337L231.166 80.7463ZM219.548 91.2768C215.183 93.6442 210.834 94.768 206.444 94.768V104.768C212.635 104.768 218.611 103.161 224.315 100.067L219.548 91.2768Z"
        fill="red"
        mask="url(#path-1-outside-1_0_1)"
      />
    </svg>
  </div>`

  return {
    appendLoading() {
      safeDOM.append(document.head, oStyle)
      safeDOM.append(document.body, oDiv)
    },
    removeLoading() {
      safeDOM.remove(document.head, oStyle)
      safeDOM.remove(document.body, oDiv)
    },
  }
}

const { appendLoading, removeLoading } = useLoading()
domReady().then(appendLoading)

let splashScreenRemoveTimeout: NodeJS.Timeout | null = null;
let removeLoadingTriggered = false;


function ensureSplashScreenVisibility() {
  if (removeLoadingTriggered) {
    removeLoading();
  } else {
    splashScreenRemoveTimeout = null;
  }
}

splashScreenRemoveTimeout = setTimeout(ensureSplashScreenVisibility, 1000);

window.onmessage = (ev) => {
  if (ev.data.payload === 'removeLoading') {
    removeLoadingTriggered = true;
    if (!splashScreenRemoveTimeout) {
      removeLoading();
    }
  }
};